TABELLE CASH FLOW WEB 

1. Transazioni
2. Account
3. CategoriaPrimaria
4. CategoriaSecondaria
5. Posizione
6. BudgetMassimoMinimo
7. Risparmi
8. Valute
9. Prestiti
10. SpeseRicorrentiPianificazioniPagamento
11. ObiettiviFinanziari

----------------

Transazioni

PK: IDTransazione
TipoTransazione
Importo
Valuta
IDAccount
Posizione
DataTransazione
IDCategoriaPrimaria
IDCategoriaSecondaria
Descrizione

--
Account

PK: IDAccount
NomeAccount
Saldo

--
CategoriaPrimaria

PK: IDCategoriaPrimaria
NomeCategoria
DescrizioneCategoria

--
CategoriaSecondaria

PK: IDCategoriaSecondaria
IDCategoriaPrimaria
NomeCategoria
DescrizioneCategoria

--
Posizione

PK: IDPosizione
Longitudine
Latitudine
NomeCitta

--
BudgetMassimoMinimo

PK: IDBudget
IDCategoria
ImportoMassimo
DataFine
DataInizio

--
Risparmi

PK: IDRisparmio
IDAccount
ImportoRisparmio
DataInizioRisparmio
DataFineRisparmio

--
Valute

PK: IDValuta
NomeValuta
Simbolo

--
Prestiti

PK: IDPrestito
IDAccount
ImportoPrestito
DataConcessione
TassoInteresse
Durata

--
SpeseRicorrentiPianificazioniPagamento

PK: IDSpesaRicorrente
IDAccount
ImportoSpesa
DataScadenza
IDCategoria

--
ObiettiviFinanziari

PK: IDObiettivo
IDAccount
DescrizioneObiettivo
ImportoObiettivo
DataScadenza
-----------------------------------


Stored Procedure per l'aggiornamento del saldo dell'account
1. 
DELIMITER //

CREATE PROCEDURE AggiornaSaldoAccount (
    IN p_IDAccount INT
)
BEGIN
    UPDATE Account
    SET Saldo = (SELECT COALESCE(SUM(Importo), 0) FROM Transazioni WHERE IDAccount = p_IDAccount)
    WHERE IDAccount = p_IDAccount;
END //

DELIMITER ;


2. 
DELIMITER //

CREATE PROCEDURE CancellaTransazione (
    IN p_IDTransazione INT
)
BEGIN
    DELETE FROM Transazioni WHERE IDTransazione = p_IDTransazione;
    -- Aggiorna il saldo dell'account dopo la cancellazione
    CALL AggiornaSaldoAccount((SELECT IDAccount FROM Transazioni WHERE IDTransazione = p_IDTransazione));
END //

DELIMITER ;


-------------
TRIGGER:

1.
DELIMITER //

CREATE TRIGGER AfterInsertTransazione
AFTER INSERT ON Transazioni
FOR EACH ROW
BEGIN
    -- Aggiorna il saldo dell'account dopo l'inserimento di una nuova transazione
    CALL AggiornaSaldoAccount(NEW.IDAccount);
END //

DELIMITER ;
